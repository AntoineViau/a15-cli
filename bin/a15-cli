#!/usr/bin/env node
'use strict';

var _ = require('lodash');
var Twig = require('twig');
Twig.cache(false);
var twig = Twig.twig;
var fs = require('fs');
var decamelize = require('decamelize');
var camelize = require('camelize');
var mkdirp = require('mkdirp');

var command = process.argv[2];
var type = process.argv[3];
var name = process.argv[4];
var dashedName = name;
var camelizedName = camelize(dashedName);
var capitalizedName = camelizedName.charAt(0).toUpperCase() + camelizedName.slice(1);
var directory = process.argv[5];

if (_.find(['generate', 'g'], function () {
    return command;
}) && _.find(['component', 'c'], function () {
    return type;
})) {
    if (!name) {
        console.error('Need a name');
    }
    if (!directory) {
        console.error('Need a directory');
    }

    mkdirp.sync(directory + '/' + dashedName);

    var layout = __dirname + '/../layout/component.js.twig';
    var templated = twig({
        path: layout,
        async: false
    }).render({
        component: {
            dashedName: dashedName,
            camelizedName: camelizedName,
            capitalizedName: capitalizedName
        }
    });
    fs.writeFileSync(directory + '/' + dashedName + '/' + dashedName + '.component.js', templated);
    fs.writeFileSync(directory + '/' + dashedName + '/' + dashedName + '.component.css', '');

    layout = __dirname + '/../layout/index.js.twig';
    templated = twig({
        path: layout,
        async: false
    }).render({
        component: {
            dashedName: dashedName,
            camelizedName: camelizedName,
            capitalizedName: capitalizedName
        }
    });
    fs.writeFileSync(directory + '/' + dashedName + '/' + 'index.js', templated);
}
